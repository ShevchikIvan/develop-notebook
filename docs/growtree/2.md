开发日记（二）集群通讯进阶设计
-------------------------
在上一篇结尾处，我提到有两方面不足：

1. 协议不规范，导致误解码
2. 今后如有服务间的通讯问题，还是得大改，暂且先这样将就用用，实现预想功能先。

关于第一点，很早就应该设计好了，单因为懒啊，加上为了调试方便，就迟迟没改，那么现在..也不会改啦（反正已经预留了接口）。

关于第二点，思考了一晚上后，觉得还是得改，改好后再统一协议。

#### 2015年11月25日 下午10:23
这里先给出__预期效果图__：



__预期效果__：message模块可以和tcpx解耦，route模块可以合并进一个service模块，这样后期给service加功能也方便，比如事件响应。

__问题__：message调度msg时，需要用到service列表和client列表，而这两个都来自tcpx.server，解耦有困难。

__解决方案__：重构内部逻辑代码（真正的大改！）

#### 2015年11月25日 下午11:30
大功告成，之前的版本中底层tcp服务和上层的gateway，乃至tcpx核心功能message（这点要明确，之前就是没有明确message的重要地位，而一直想将它解耦，结果弄巧成拙）关联太大。

产生这个问题的__主要原因__是：我默认以gateway服务为核心，将其扩展为整个tcpx结构的核心。

__解决方案__：现在我以一个全新的模块daemon为核心，将gateway的功能抽离出来，作为daemon的一个组件（组合方式参考了docker源码）然后最最激动人心的是tcpx正式改名为__hazel__！！！！原本的tcpx仅作为一个底层服务，类似于docker里的apiserver。
